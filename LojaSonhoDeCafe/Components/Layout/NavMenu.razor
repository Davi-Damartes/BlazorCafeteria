@implements IDisposable
@inject ICarrinhoCompraService carrinhoCompraService
@inject NavigationManager NavigationManager


<div class="nav-item px-3">
    <NavLink class="nav-link" href="Produtos">
        <svg style="height: 25px; width: 25px; margin-right: 5px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
            <path fill="#ffd700" d="M416 0C400 0 288 32 288 176V288c0 35.3 28.7
            64 64 64h32V480c0 17.7 14.3 32 32 32s32-14.3 32-32V352 240 32c0-17.7-14.3-32-32-32zM64
            16C64 7.8 57.9 1 49.7 .1S34.2 4.6 32.4 12.5L2.1 148.8C.7 155.1 0 161.5 0 167.9c0 45.9
            35.1 83.6 80 87.7V480c0 17.7 14.3 32 32 32s32-14.3 32-32V255.6c44.9-4.1 80-41.8
            80-87.7c0-6.4-.7-12.8-2.1-19.1L191.6 12.5c-1.8-8-9.3-13.3-17.4-12.4S160 7.8 160
            16V150.2c0 5.4-4.4 9.8-9.8 9.8c-5.1 0-9.3-3.9-9.8-9L127.9 14.6C127.2 6.3 120.3 0
            112 0s-15.2 6.3-15.9 14.6L83.7 151c-.5 5.1-4.7 9-9.8 9c-5.4 0-9.8-4.4-9.8-9.8V16zm48.3
            -.3 0-.3 0 .3-.7 .3 .7z" />
        </svg> Produtos
    </NavLink>
</div>
<ProdutosCategoriaNavMenu />

<div class="nav-item px-3">
    <NavLink class="nav-link" href="CadastroProduto">
        <svg style="height: 25px; width: 25px; margin-right: 5px;"  xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 576 512">
        <path fill="#007bff" d="M512 80c8.8 0 16 7.2 16 16V416c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V96c0-8.8 7.2-16 16-16H512zM64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H512c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM208 256a64 64 0 1 0 0-128 64 64 0 1 0 0 128zm-32 32c-44.2 0-80 35.8-80 80c0 8.8 7.2 16 16 16H304c8.8 0 16-7.2 16-16c0-44.2-35.8-80-80-80H176zM376 144c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24H376zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24H376z" /></svg> Cadastrar Produto
    </NavLink>
</div>

<div class="nav-item px-3">
    <NavLink class="nav-link" href="Faturamento">
        <svg xmlns="http://www.w3.org/2000/svg" style="height: 25px; width: 25px; margin-right: 5px;" viewBox="0 0 512 512">
            <path fill="#63E6BE" d="M64 0C46.3 0 32 14.3 32 32V96c0 17.7 14.3
                32 32 32h80v32H87c-31.6 0-58.5 23.1-63.3 54.4L1.1 364.1C.4 368.8 0 373.6 0 378.4V448c0
                35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V378.4c0-4.8-.4-9.6-1.1-14.4L488.2 214.4C483.5
                183.1 456.6 160 425 160H208V128h80c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H64zM96
                48H256c8.8 0 16 7.2 16 16s-7.2 16-16 16H96c-8.8 0-16-7.2-16-16s7.2-16 16-16zM64 432c0-8.8
                7.2-16 16-16H432c8.8 0 16 7.2 16 16s-7.2 16-16 16H80c-8.8 0-16-7.2-16-16zm48-168a24 24 0 1 1
                0-48 24 24 0 1 1 0 48zm120-24a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM160 344a24 24 0 1 1 0-48 24
                24 0 1 1 0 48zM328 240a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM256 344a24 24 0 1 1 0-48 24 24 0 1 1
                0 48zM424 240a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM352 344a24 24 0 1 1 0-48 24 24 0 1 1 0 48z" />
        </svg> Faturamento
    </NavLink>
</div>

<div class="nav-item px-3 d-sm-none">
    <NavLink class="nav-link" href="CarrinhoCompra">
        <i class="fa-solid fa-cart-arrow-down"></i>&nbsp;Carrinho(<b>@carrinhoCompraItemContador</b>)
    </NavLink>
</div>


<AuthorizeView>
    <Authorized>
        <!-- Dropdown de usuário logado -->
        <div class="dropdown nav-item px-3 ">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownLogged" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="bi bi-person-fill-nav-menu" aria-hidden="true"></span> @context.User.Identity?.Name
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdownLogged">
                <li><a class="dropdown-item" href="Account/Manage">Gerenciador de Conta</a></li>
                <li>
                    <form action="Account/Logout" method="post">
                        <AntiforgeryToken />
                        <input type="hidden" name="ReturnUrl" value="@currentUrl" />
                        <button type="submit" class="dropdown-item">
                            Deslogar
                        </button>
                    </form>
                </li>
                <li><a class="dropdown-item" href="Auth">Autenticador</a></li>
            </ul>
        </div>
    </Authorized>
    <NotAuthorized>
        <!-- Dropdown de usuário não logado -->
        <div class="dropdown nav-item px-3">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownNotLogged" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="bi bi-person-nav-menu" aria-hidden="true"></span> Conta
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdownNotLogged">
                <li><a class="dropdown-item" href="Account/Register">Registrar</a></li>
                <li><a class="dropdown-item" href="Account/Login">Login</a></li>
                <li><a class="dropdown-item" href="Auth">Autenticador</a></li>
            </ul>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {

    private string? currentUrl;

    private int carrinhoCompraItemContador = 0;


    protected override void OnInitialized( )
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;

        carrinhoCompraService.OnCarrinhoCompraChanged += CarrinhoCompraChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    protected void CarrinhoCompraChanged(int totalQuantidade)
    {
        carrinhoCompraItemContador = totalQuantidade;
        StateHasChanged();
    }

    public void Dispose( )
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
        carrinhoCompraService.OnCarrinhoCompraChanged -= CarrinhoCompraChanged;
    }

}

    @* <div class="nav-item px-3">
    <NavLink class="nav-link" href="auth">
        <span class="bi bi-lock-nav-menu" aria-hidden="true"></span> Verificar Autenticação
    </NavLink>
</div>
 *@